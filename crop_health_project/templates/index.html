<!DOCTYPE html>
<html>
<head>
    <title>Smart Crop Health Monitor</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            background: linear-gradient(-45deg, #00c853, #64dd17, #00e5ff, #1de9b6);
            background-size: 300% 300%;
            animation: gradientMove 12s ease infinite;
            color: white;
            text-align: center;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        h1 {
            padding-top: 40px;
            font-weight: 700;
            font-size: 36px;
        }

        .card {
            background: rgba(255,255,255,0.15);
            padding: 40px;
            border-radius: 25px;
            width: 420px;
            margin: 40px auto;
            backdrop-filter: blur(15px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            transition: 0.3s ease;
        }

        .card:hover {
            transform: scale(1.03);
        }

        input, select, button {
            padding: 12px;
            width: 95%;
            margin: 12px 0;
            border-radius: 10px;
            border: none;
            font-size: 14px;
        }

        button {
            background: linear-gradient(45deg, #00e676, #00c853);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover {
            transform: scale(1.05);
        }

        .input-container {
            position: relative;
        }

        #suggestions {
            background: white;
            color: black;
            border-radius: 5px;
            max-height: 150px;
            overflow-y: auto;
            text-align: left;
            position: absolute;
            width: 100%;
            z-index: 1000;
        }

        #suggestions div {
            padding: 10px;
            cursor: pointer;
        }

        #suggestions div:hover {
            background-color: #f0f0f0;
        }

        #map {
            height: 400px;
            margin: 40px auto;
            width: 90%;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }
    </style>
</head>

<body>

<h1>ðŸŒ¾ Smart Crop Health Monitor</h1>

<div class="card">
    <form action="/analyze" method="POST">

        <div class="input-container">
            <input type="text" id="location" placeholder="Enter location" autocomplete="off" required>
            <div id="suggestions"></div>
        </div>

        <input type="hidden" name="latitude" id="latitude">
        <input type="hidden" name="longitude" id="longitude">

        <select name="language">
            <option value="english">English</option>
            <option value="tamil">Tamil</option>
        </select>

        <button type="submit">ðŸŒ± Analyze Crop Health</button>

    </form>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const input = document.getElementById("location");
const suggestionsBox = document.getElementById("suggestions");
const latInput = document.getElementById("latitude");
const lonInput = document.getElementById("longitude");

let map = L.map('map').setView([20.5937, 78.9629], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let marker = null;

let debounceTimer;
input.addEventListener("input", function() {
    const query = input.value;
    if (!query) { suggestionsBox.innerHTML = ""; return; }

    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
        fetch(`https://photon.komoot.io/api/?q=${encodeURIComponent(query)}&limit=5`)
            .then(res => res.json())
            .then(data => {
                suggestionsBox.innerHTML = "";
                data.features.forEach(f => {
                    const div = document.createElement("div");
                    div.textContent = f.properties.name +
                        (f.properties.city ? ", " + f.properties.city : "") +
                        (f.properties.country ? ", " + f.properties.country : "");

                    div.addEventListener("click", () => {
                        input.value = div.textContent;
                        const lat = f.geometry.coordinates[1];
                        const lon = f.geometry.coordinates[0];
                        latInput.value = lat;
                        lonInput.value = lon;
                        suggestionsBox.innerHTML = "";

                        map.setView([lat, lon], 16);

                        if (marker) {
                            marker.setLatLng([lat, lon]);
                        } else {
                            marker = L.marker([lat, lon], {draggable: true}).addTo(map);
                        }

                        marker.on('dragend', function(e){
                            const pos = e.target.getLatLng();
                            latInput.value = pos.lat;
                            lonInput.value = pos.lng;
                        });
                    });

                    suggestionsBox.appendChild(div);
                });
            });
    }, 300);
});

document.addEventListener("click", function(e) {
    if (!input.contains(e.target)) {
        suggestionsBox.innerHTML = "";
    }
});
</script>

</body>
</html>